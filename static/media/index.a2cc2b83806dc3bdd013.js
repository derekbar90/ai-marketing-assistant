import _toConsumableArray from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _asyncToGenerator from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js";import _objectSpread from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _createForOfIteratorHelper from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js";import _inherits from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js";import _wrapNativeSuper from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js";import _regeneratorRuntime from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js";import _slicedToArray from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _classCallCheck from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js";import{b as xs,d as kt,e as Ss,f as Ps,g as at,h as Ge,i as Ut,j as Lt}from"./chunk-SJVDOE3S.js";import{d as ot}from"./chunk-TAZBUB4Z.js";import{a as Nt,b as Gt,c as vs,d as Rs}from"./chunk-3BCYDNSE.js";import{b as Ne,c as Ts,d as f,e as x,f as P,g as p,i as b}from"./chunk-Y3AVQXKT.js";b(),b(),b();var ri=new Error("timeout while waiting for mutex to become available"),ii=new Error("mutex already locked"),Ds=new Error("request for lock canceled"),Is=function(e,t,n,r){return new(n||(n=Promise))((function(a,s){function i(e){try{o(r.next(e))}catch(t){s(t)}}function u(e){try{o(r.throw(e))}catch(t){s(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,u)}o((r=r.apply(e,t||[])).next())}))},lt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ds;_classCallCheck(this,e),this._value=t,this._cancelError=n,this._weightedQueues=[],this._weightedWaiters=[]}return _createClass(e,[{key:"acquire",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(n,r){e._weightedQueues[t-1]||(e._weightedQueues[t-1]=[]),e._weightedQueues[t-1].push({resolve:n,reject:r}),e._dispatch()}))}},{key:"runExclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Is(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var r,a,s,i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.acquire(t);case 2:return r=n.sent,a=_slicedToArray(r,2),s=a[0],i=a[1],n.prev=6,n.next=9,e(s);case 9:return n.abrupt("return",n.sent);case 10:return n.prev=10,i(),n.finish(10);case 13:case"end":return n.stop()}}),n,this,[[6,,10,13]])})))}},{key:"waitForUnlock",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(n){e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),e._weightedWaiters[t-1].push(n),e._dispatch()}))}},{key:"isLocked",value:function(){return this._value<=0}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e,this._dispatch()}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<=0)throw new Error("invalid weight ".concat(e,": must be positive"));this._value+=e,this._dispatch()}},{key:"cancel",value:function(){var e=this;this._weightedQueues.forEach((function(t){return t.forEach((function(t){return t.reject(e._cancelError)}))})),this._weightedQueues=[]}},{key:"_dispatch",value:function(){for(var e,t=this._value;t>0;t--){var n=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(n){var r=this._value,a=t;this._value-=t,t=this._value+1,n.resolve([r,this._newReleaser(a)])}}this._drainUnlockWaiters()}},{key:"_newReleaser",value:function(e){var t=this,n=!1;return function(){n||(n=!0,t.release(e))}}},{key:"_drainUnlockWaiters",value:function(){for(var e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((function(e){return e()})),this._weightedWaiters[e-1]=[])}}]),e}(),Ms=function(e,t,n,r){return new(n||(n=Promise))((function(a,s){function i(e){try{o(r.next(e))}catch(t){s(t)}}function u(e){try{o(r.throw(e))}catch(t){s(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,u)}o((r=r.apply(e,t||[])).next())}))},$=function(){function e(t){_classCallCheck(this,e),this._semaphore=new lt(1,t)}return _createClass(e,[{key:"acquire",value:function(){return Ms(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._semaphore.acquire();case 2:return t=e.sent,n=_slicedToArray(t,2),r=n[1],e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"runExclusive",value:function(e){return this._semaphore.runExclusive((function(){return e()}))}},{key:"isLocked",value:function(){return this._semaphore.isLocked()}},{key:"waitForUnlock",value:function(){return this._semaphore.waitForUnlock()}},{key:"release",value:function(){this._semaphore.isLocked()&&this._semaphore.release()}},{key:"cancel",value:function(){return this._semaphore.cancel()}}]),e}();b();import Os from"./postgres.js";var qt=Os,Xt={};Ne(Xt,{parseResults:function(){return Ye}}),b();var Wt={};Ne(Wt,{AuthenticationCleartextPassword:function(){return ge},AuthenticationMD5Password:function(){return we},AuthenticationOk:function(){return me},AuthenticationSASL:function(){return be},AuthenticationSASLContinue:function(){return Ee},AuthenticationSASLFinal:function(){return Ae},BackendKeyDataMessage:function(){return Re},CommandCompleteMessage:function(){return k},CopyDataMessage:function(){return Te},CopyResponse:function(){return xe},DataRowMessage:function(){return z},DatabaseError:function(){return G},Field:function(){return Se},NoticeMessage:function(){return K},NotificationResponseMessage:function(){return H},ParameterDescriptionMessage:function(){return Pe},ParameterStatusMessage:function(){return ve},ReadyForQueryMessage:function(){return De},RowDescriptionMessage:function(){return q},bindComplete:function(){return ce},closeComplete:function(){return ue},copyDone:function(){return ye},emptyQuery:function(){return pe},noData:function(){return he},parseComplete:function(){return le},portalSuspended:function(){return fe},replicationStart:function(){return de}}),b(),b();var _s=Object.defineProperty,zt=function(e){throw TypeError(e)},Cs=function(e,t){for(var n in t)_s(e,n,{get:t[n],enumerable:!0})},ct=function(e,t,n){return t.has(e)||zt("Cannot "+n)},n=function(e,t,n){return ct(e,t,"read from private field"),n?n.call(e):t.get(e)},v=function(e,t,n){return t.has(e)?zt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n)},g=function(e,t,n,r){return ct(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n},m=function(e,t,n){return ct(e,t,"access private method"),n},ut=function(e,t,r,a){return{set _(n){g(e,t,n,r)},get _(){return n(e,t,a)}}},ht={};Cs(ht,{AuthenticationCleartextPassword:function(){return ge},AuthenticationMD5Password:function(){return we},AuthenticationOk:function(){return me},AuthenticationSASL:function(){return be},AuthenticationSASLContinue:function(){return Ee},AuthenticationSASLFinal:function(){return Ae},BackendKeyDataMessage:function(){return Re},CommandCompleteMessage:function(){return k},CopyDataMessage:function(){return Te},CopyResponse:function(){return xe},DataRowMessage:function(){return z},DatabaseError:function(){return G},Field:function(){return Se},NoticeMessage:function(){return K},NotificationResponseMessage:function(){return H},ParameterDescriptionMessage:function(){return Pe},ParameterStatusMessage:function(){return ve},ReadyForQueryMessage:function(){return De},RowDescriptionMessage:function(){return q},bindComplete:function(){return ce},closeComplete:function(){return ue},copyDone:function(){return ye},emptyQuery:function(){return pe},noData:function(){return he},parseComplete:function(){return le},portalSuspended:function(){return fe},replicationStart:function(){return de}});var le={name:"parseComplete",length:5},ce={name:"bindComplete",length:5},ue={name:"closeComplete",length:5},he={name:"noData",length:5},fe={name:"portalSuspended",length:5},de={name:"replicationStart",length:4},pe={name:"emptyQuery",length:4},ye={name:"copyDone",length:4},me=_createClass((function e(t){_classCallCheck(this,e),this.length=t,this.name="authenticationOk"})),ge=_createClass((function e(t){_classCallCheck(this,e),this.length=t,this.name="authenticationCleartextPassword"})),we=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.salt=n,this.name="authenticationMD5Password"})),be=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.mechanisms=n,this.name="authenticationSASL"})),Ee=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.data=n,this.name="authenticationSASLContinue"})),Ae=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.data=n,this.name="authenticationSASLFinal"})),G=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var s;return _classCallCheck(this,n),(s=t.call(this,e)).length=r,s.name=a,s}return _createClass(n)}(_wrapNativeSuper(Error)),Te=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.chunk=n,this.name="copyData"})),xe=_createClass((function e(t,n,r,a){_classCallCheck(this,e),this.length=t,this.name=n,this.binary=r,this.columnTypes=new Array(a)})),Se=_createClass((function e(t,n,r,a,s,i,u){_classCallCheck(this,e),this.name=t,this.tableID=n,this.columnID=r,this.dataTypeID=a,this.dataTypeSize=s,this.dataTypeModifier=i,this.format=u})),q=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.fieldCount=n,this.name="rowDescription",this.fields=new Array(this.fieldCount)})),Pe=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.parameterCount=n,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)})),ve=_createClass((function e(t,n,r){_classCallCheck(this,e),this.length=t,this.parameterName=n,this.parameterValue=r,this.name="parameterStatus"})),Re=_createClass((function e(t,n,r){_classCallCheck(this,e),this.length=t,this.processID=n,this.secretKey=r,this.name="backendKeyData"})),H=_createClass((function e(t,n,r,a){_classCallCheck(this,e),this.length=t,this.processId=n,this.channel=r,this.payload=a,this.name="notification"})),De=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.status=n,this.name="readyForQuery"})),k=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.text=n,this.name="commandComplete"})),z=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.fields=n,this.name="dataRow",this.fieldCount=n.length})),K=_createClass((function e(t,n){_classCallCheck(this,e),this.length=t,this.message=n,this.name="notice"})),Yt={};Ne(Yt,{ABSTIME:function(){return js},ACLITEM:function(){return er},BIT:function(){return nr},BOOL:function(){return ft},BPCHAR:function(){return tr},BYTEA:function(){return We},CHAR:function(){return Qt},CID:function(){return Ns},CIDR:function(){return Vs},CIRCLE:function(){return Ks},DATE:function(){return wt},FLOAT4:function(){return mt},FLOAT8:function(){return je},GTSVECTOR:function(){return Ar},INET:function(){return Zs},INT2:function(){return dt},INT4:function(){return pt},INT8:function(){return Ie},INTERVAL:function(){return rr},JSON:function(){return Ve},JSONB:function(){return At},MACADDR:function(){return Js},MACADDR8:function(){return Ys},MONEY:function(){return Xs},NUMERIC:function(){return or},OID:function(){return yt},PATH:function(){return Ws},PG_DEPENDENCIES:function(){return wr},PG_LSN:function(){return mr},PG_NDISTINCT:function(){return gr},PG_NODE_TREE:function(){return qs},POLYGON:function(){return Qs},REFCURSOR:function(){return lr},REGCLASS:function(){return fr},REGCONFIG:function(){return Tr},REGDICTIONARY:function(){return xr},REGNAMESPACE:function(){return Sr},REGOPER:function(){return ur},REGOPERATOR:function(){return hr},REGPROC:function(){return ks},REGPROCEDURE:function(){return cr},REGROLE:function(){return Pr},REGTYPE:function(){return dr},RELTIME:function(){return $s},SMGR:function(){return zs},TEXT:function(){return Qe},TID:function(){return Us},TIME:function(){return sr},TIMESTAMP:function(){return bt},TIMESTAMPTZ:function(){return Et},TIMETZ:function(){return ir},TINTERVAL:function(){return Hs},TSQUERY:function(){return Er},TSVECTOR:function(){return br},TXID_SNAPSHOT:function(){return yr},UUID:function(){return pr},VARBIT:function(){return ar},VARCHAR:function(){return gt},XID:function(){return Ls},XML:function(){return Gs},arrayTypes:function(){return qe},parseArray:function(){return Kt},parseType:function(){return Ke},parsers:function(){return Vt},serializeType:function(){return He},serializerFor:function(){return $t},serializerInstanceof:function(){return jt},serializers:function(){return ze},types:function(){return Tt}}),b();var Fs=globalThis.JSON.parse,Bs=globalThis.JSON.stringify,ft=16,We=17,Qt=18,Ie=20,dt=21,pt=23,ks=24,Qe=25,yt=26,Us=27,Ls=28,Ns=29,Ve=114,Gs=142,qs=194,zs=210,Ws=602,Qs=604,Vs=650,mt=700,je=701,js=702,$s=703,Hs=704,Ks=718,Ys=774,Xs=790,Js=829,Zs=869,er=1033,tr=1042,gt=1043,wt=1082,sr=1083,bt=1114,Et=1184,rr=1186,ir=1266,nr=1560,ar=1562,or=1700,lr=1790,cr=2202,ur=2203,hr=2204,fr=2205,dr=2206,pr=2950,yr=2970,mr=3220,gr=3361,wr=3402,br=3614,Er=3615,Ar=3642,Tr=3734,xr=3769,At=3802,Sr=4089,Pr=4096,qe={1001:We,1002:Qt,1016:Ie,1005:dt,1007:pt,1009:Qe,1028:yt,199:Ve,1021:mt,1022:je,1015:gt,3807:At,1182:wt,1115:bt,1116:Et},Tt={string:{to:0,from:[Qe,gt],serialize:function(e){return e},parse:function(e){return e},forceTo:Qe},number:{to:0,from:[dt,pt,yt,mt,je],serialize:function(e){return e.toString()},parse:function(e){return+e},forceTo:function(e){return Number.isInteger(e)?Ie:je}},bigint:{to:Ie,from:[Ie],js:[BigInt],serialize:function(e){return e.toString()},parse:function(e){var t=BigInt(e);return t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER?t:Number(t)}},json:{to:Ve,from:[Ve,At],serialize:function(e){return Bs(e)},parse:function(e){return Fs(e)}},boolean:{to:ft,from:[ft],serialize:function(e){return!0===e?"t":"f"},parse:function(e){return"t"===e}},date:{to:1184,from:[wt,bt,Et],js:[Date],serialize:function(e){return(e instanceof Date?e:new Date(e)).toISOString()},parse:function(e){return new Date(e)}},bytea:{to:We,from:[We],js:[Uint8Array],serialize:function(e){return"\\x"+Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},parse:function(e){var t=e.slice(2);return Uint8Array.from({length:t.length/2},(function(e,n){return parseInt(t.substring(2*n,2*(n+1)),16)}))}},array:{to:0,from:Object.keys(qe).map((function(e){return+e})),serialize:function(e){return Ht(e)},parse:function(e,t){var n;return t&&t in qe&&(n=Vt[qe[t]]),Kt(e,n)}}},$e=Rr(Tt),Vt=$e.parsers,ze=$e.serializers,jt=$e.serializerInstanceof;function $t(e){if(Array.isArray(e))return ze.array;var t=ze[typeof e];if(t)return t;var n,r=_createForOfIteratorHelper(jt);try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray(n.value,2),s=a[0],i=a[1];if(e instanceof s)return i}}catch(u){r.e(u)}finally{r.f()}return ze.json}function He(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==e?[null,0]:$t(e)(e,t)}function vr(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Ht(e){for(var t="{",n=0;n<e.length;n++)if(n>0&&(t+=","),null===e[n]||typeof e[n]>"u")t+="NULL";else if(Array.isArray(e[n]))t+=Ht(e[n]);else if(ArrayBuffer.isView(e[n])||e[n]instanceof ArrayBuffer){var r=ArrayBuffer.isView(e[n])?new Uint8Array(e[n].buffer,e[n].byteOffset,e[n].byteLength):new Uint8Array(e[n]);t+="\\"+Tt.bytea.serialize(r)}else t+=vr(He(e[n])[0]);return t+="}"}function Kt(e,t){var n,r=0,a=null,s="",i=!1,u=0;return function e(o){for(var c=[];r<o.length;r++){if(a=o[r],i)"\\"===a?s+=o[++r]:'"'===a?(c.push(t?t(s):s),s="",i='"'===o[r+1],u=r+2):s+=a;else if('"'===a)i=!0;else if("{"===a)u=++r,c.push(e(o));else{if("}"===a){i=!1,u<r&&c.push(t?t(o.slice(u,r)):o.slice(u,r)),u=r+1;break}","===a&&"}"!==n&&'"'!==n&&(c.push(t?t(o.slice(u,r)):o.slice(u,r)),u=r+1)}n=a}return u<r&&c.push(t?t(o.slice(u,r+1)):o.slice(u,r+1)),c}(e)[0]}function Ke(e,t,n){var r;if(null===e)return null;var a=null!==(r=null===n||void 0===n?void 0:n[t])&&void 0!==r?r:$e.parsers[t];return a?a(e,t):e}function Rr(e){return Object.keys(e).reduce((function(t,n){var r=t.parsers,a=t.serializers,s=t.serializerInstanceof,i=e[n],u=i.to,o=i.from,c=i.serialize,h=i.parse,l=void 0===h?null:h,f=i.forceTo,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[c(e),t&&f?"function"==typeof f?f(e):f:u]};return a[u]=p,a[n]=p,e[n].js&&e[n].js.forEach((function(e){return s.push([e,p])})),l&&(Array.isArray(o)?o.forEach((function(e){return r[e]=l})):r[o]=l,r[n]=l),{parsers:r,serializers:a,serializerInstanceof:s}}),{parsers:{},serializers:{},serializerInstanceof:[]})}function Ye(e,t,n){var r=[],a={rows:[],fields:[]},s=0,i=e.filter((function(e){return e instanceof q||e instanceof z||e instanceof k}));return i.forEach((function(e,u){e instanceof q?a.fields=e.fields.map((function(e){return{name:e.name,dataTypeID:e.dataTypeID}})):e instanceof z&&a?"array"===(null===t||void 0===t?void 0:t.rowMode)?a.rows.push(e.fields.map((function(e,n){return Ke(e,a.fields[n].dataTypeID,null===t||void 0===t?void 0:t.parsers)}))):a.rows.push(Object.fromEntries(e.fields.map((function(e,n){return[a.fields[n].name,Ke(e,a.fields[n].dataTypeID,null===t||void 0===t?void 0:t.parsers)]})))):e instanceof k&&(s+=Dr(e),u===i.length-1?r.push(_objectSpread(_objectSpread({},a),{},{affectedRows:s},n?{blob:n}:{})):r.push(a),a={rows:[],fields:[]})})),0===r.length&&r.push({rows:[],fields:[]}),r}function Dr(e){var t=e.text.split(" ");switch(t[0]){case"INSERT":return parseInt(t[2],10);case"UPDATE":case"DELETE":return parseInt(t[1],10);default:return 0}}b();var Jt=Ts(xs(),1);function xt(e){return _xt.apply(this,arguments)}function _xt(){return(_xt=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s,i,u,o,c,h,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Nt){e.next=23;break}return e.next=3,import("fs");case 3:return n=e.sent,e.next=6,import("zlib");case 6:return r=e.sent,e.next=9,import("stream");case 9:return a=e.sent,s=a.Writable,e.next=13,import("stream/promises");case 13:if(i=e.sent,u=i.pipeline,n.existsSync(t)){e.next=17;break}throw new Error("Extension bundle not found: ".concat(t));case 17:return o=r.createGunzip(),c=[],e.next=20,u(n.createReadStream(t),o,new s({write:function(e,t,n){c.push(e),n()}}));case 20:return e.abrupt("return",new Blob(c));case 23:return e.next=25,fetch(t.toString());case 25:if((h=e.sent).ok&&h.body){e.next=28;break}return e.abrupt("return",null);case 28:if("gzip"!==h.headers.get("Content-Encoding")){e.next=30;break}return e.abrupt("return",h.blob());case 30:return l=new DecompressionStream("gzip"),e.abrupt("return",new Response(h.body.pipeThrough(l)).blob());case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zt(e,t){return _Zt.apply(this,arguments)}function _Zt(){return(_Zt=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=_regeneratorRuntime().keys(t.pg_extensions);case 1:if((e.t1=e.t0()).done){e.next=26;break}return r=e.t1.value,a=void 0,e.prev=4,e.next=7,t.pg_extensions[r];case 7:a=e.sent,e.next=14;break;case 10:return e.prev=10,e.t2=e.catch(4),console.error("Failed to fetch extension:",r,e.t2),e.abrupt("continue",1);case 14:if(!a){e.next=23;break}return e.t3=Uint8Array,e.next=18,a.arrayBuffer();case 18:e.t4=e.sent,s=new e.t3(e.t4),Ir(t,r,s,n),e.next=24;break;case 23:console.error("Could not get binary data for extension:",r);case 24:e.next=1;break;case 26:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function Ir(e,t,n,r){Jt.default.untar(n).forEach((function(t){if(!t.name.startsWith(".")){var n=e.WASM_PREFIX+"/"+t.name;if(t.name.endsWith(".so")){e.FS.createPreloadedFile(Mr(n),t.name.split("/").pop().slice(0,-3),t.data,!0,!0,(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r("pgfs:ext OK",n,t)}),(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r("pgfs:ext FAIL",n,t)}),!1)}else e.FS.writeFile(n,t.data)}}))}function Mr(e){var t=e.lastIndexOf("/");return t>0?e.slice(0,t):e}var bs={};function Ze(e){for(var t=e.length,n=e.length-1;n>=0;n--){var r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}Ne(bs,{Parser:function(){return st},messages:function(){return ht},serialize:function(){return U}}),b();var R,T,Oe,vt,Me,O,Je,se,ms,et=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;_classCallCheck(this,e),this.size=t,v(this,O),v(this,R),v(this,T,5),v(this,Oe,!1),v(this,vt,new TextEncoder),v(this,Me,0),g(this,R,m(this,O,Je).call(this,t))}return _createClass(e,[{key:"addInt32",value:function(e){return m(this,O,se).call(this,4),n(this,R).setInt32(n(this,T),e,n(this,Oe)),g(this,T,n(this,T)+4),this}},{key:"addInt16",value:function(e){return m(this,O,se).call(this,2),n(this,R).setInt16(n(this,T),e,n(this,Oe)),g(this,T,n(this,T)+2),this}},{key:"addCString",value:function(e){return e&&this.addString(e),m(this,O,se).call(this,1),n(this,R).setUint8(n(this,T),0),ut(this,T)._++,this}},{key:"addString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Ze(e);return m(this,O,se).call(this,t),n(this,vt).encodeInto(e,new Uint8Array(n(this,R).buffer,n(this,T))),g(this,T,n(this,T)+t),this}},{key:"add",value:function(e){return m(this,O,se).call(this,e.byteLength),new Uint8Array(n(this,R).buffer).set(new Uint8Array(e),n(this,T)),g(this,T,n(this,T)+e.byteLength),this}},{key:"flush",value:function(e){var t=m(this,O,ms).call(this,e);return g(this,T,5),g(this,R,m(this,O,Je).call(this,this.size)),new Uint8Array(t)}}]),e}();R=new WeakMap,T=new WeakMap,Oe=new WeakMap,vt=new WeakMap,Me=new WeakMap,O=new WeakSet,Je=function(e){return new DataView(new ArrayBuffer(e))},se=function(e){if(n(this,R).byteLength-n(this,T)<e){var t=n(this,R).buffer,r=t.byteLength+(t.byteLength>>1)+e;g(this,R,m(this,O,Je).call(this,r)),new Uint8Array(n(this,R).buffer).set(new Uint8Array(t))}},ms=function(e){if(e){n(this,R).setUint8(n(this,Me),e);var t=n(this,T)-(n(this,Me)+1);n(this,R).setInt32(n(this,Me)+1,t,n(this,Oe))}return n(this,R).buffer.slice(e?0:5,n(this,T))};var W,S,Rt,Dt,Xe,w=new et,Or=function(e){w.addInt16(3).addInt16(0);for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];w.addCString(r).addCString(e[r])}w.addCString("client_encoding").addCString("UTF8");var a=w.addCString("").flush(),s=a.byteLength+4;return(new et).addInt32(s).add(a).flush()},_r=function(){var e=new DataView(new ArrayBuffer(8));return e.setInt32(0,8,!1),e.setInt32(4,80877103,!1),new Uint8Array(e.buffer)},Cr=function(e){return w.addCString(e).flush(112)},Fr=function(e,t){return w.addCString(e).addInt32(Ze(t)).addString(t),w.flush(112)},Br=function(e){return w.addString(e).flush(112)},kr=function(e){return w.addCString(e).flush(81)},Ur=[],Lr=function(e){var t,n,r,a,s=null!==(t=e.name)&&void 0!==t?t:"";s.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",s,s.length),console.error("This can cause conflicts and silent errors executing queries"));var i=w.addCString(s).addCString(e.text).addInt16(null!==(n=null===(r=e.types)||void 0===r?void 0:r.length)&&void 0!==n?n:0);return null!==(a=e.types)&&void 0!==a&&a.forEach((function(e){return i.addInt32(e)})),w.flush(80)},re=new et,Nr=function(e,t){for(var n=0;n<e.length;n++){var r=t?t(e[n],n):e[n];if(null===r)w.addInt16(0),re.addInt32(-1);else if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)){var a=ArrayBuffer.isView(r)?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r;w.addInt16(1),re.addInt32(a.byteLength),re.add(a)}else w.addInt16(0),re.addInt32(Ze(r)),re.addString(r)}},Gr=function(){var e,t,n,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=null!==(e=a.portal)&&void 0!==e?e:"",i=null!==(t=a.statement)&&void 0!==t?t:"",u=null!==(n=a.binary)&&void 0!==n&&n,o=null!==(r=a.values)&&void 0!==r?r:Ur,c=o.length;return w.addCString(s).addCString(i),w.addInt16(c),Nr(o,a.valueMapper),w.addInt16(c),w.add(re.flush()),w.addInt16(u?1:0),w.flush(66)},qr=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),zr=function(e){var t,n;if(!e||!e.portal&&!e.rows)return qr;var r=null!==(t=e.portal)&&void 0!==t?t:"",a=null!==(n=e.rows)&&void 0!==n?n:0,s=Ze(r),i=4+s+1+4,u=new DataView(new ArrayBuffer(1+i));return u.setUint8(0,69),u.setInt32(1,i,!1),(new TextEncoder).encodeInto(r,new Uint8Array(u.buffer,5)),u.setUint8(s+5,0),u.setUint32(u.byteLength-4,a,!1),new Uint8Array(u.buffer)},Wr=function(e,t){var n=new DataView(new ArrayBuffer(16));return n.setInt32(0,16,!1),n.setInt16(4,1234,!1),n.setInt16(6,5678,!1),n.setInt32(8,e,!1),n.setInt32(12,t,!1),new Uint8Array(n.buffer)},Mt=function(e,t){var n=new et;return n.addCString(t),n.flush(e)},Qr=w.addCString("P").flush(68),Vr=w.addCString("S").flush(68),jr=function(e){var t;return e.name?Mt(68,"".concat(e.type).concat(null!==(t=e.name)&&void 0!==t?t:"")):"P"===e.type?Qr:Vr},$r=function(e){var t,n="".concat(e.type).concat(null!==(t=e.name)&&void 0!==t?t:"");return Mt(67,n)},Hr=function(e){return w.add(e).flush(100)},Kr=function(e){return Mt(102,e)},tt=function(e){return new Uint8Array([e,0,0,0,4])},Yr=tt(72),Xr=tt(83),Jr=tt(88),Zr=tt(99),U={startup:Or,password:Cr,requestSsl:_r,sendSASLInitialResponseMessage:Fr,sendSCRAMClientFinalMessage:Br,query:kr,parse:Lr,bind:Gr,execute:zr,describe:jr,close:$r,flush:function(){return Yr},sync:function(){return Xr},end:function(){return Jr},copyData:Hr,copyDone:function(){return Zr},copyFail:Kr,cancel:Wr},es={text:0,binary:1},ei=new ArrayBuffer(0),ti=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,e),v(this,W,new DataView(ei)),v(this,S),v(this,Rt,"utf-8"),v(this,Dt,new TextDecoder(n(this,Rt))),v(this,Xe,!1),g(this,S,t)}return _createClass(e,[{key:"setBuffer",value:function(e,t){g(this,S,e),g(this,W,new DataView(t))}},{key:"int16",value:function(){var e=n(this,W).getInt16(n(this,S),n(this,Xe));return g(this,S,n(this,S)+2),e}},{key:"byte",value:function(){var e=n(this,W).getUint8(n(this,S));return ut(this,S)._++,e}},{key:"int32",value:function(){var e=n(this,W).getInt32(n(this,S),n(this,Xe));return g(this,S,n(this,S)+4),e}},{key:"string",value:function(e){return n(this,Dt).decode(this.bytes(e))}},{key:"cstring",value:function(){for(var e=n(this,S),t=e;0!==n(this,W).getUint8(t++););var r=this.string(t-e-1);return g(this,S,t),r}},{key:"bytes",value:function(e){var t=n(this,W).buffer.slice(n(this,S),n(this,S)+e);return g(this,S,n(this,S)+e),new Uint8Array(t)}}]),e}();W=new WeakMap,S=new WeakMap,Rt=new WeakMap,Dt=new WeakMap,Xe=new WeakMap;var D,I,M,h,E,gs,ws,rs,is,ns,as,os,St,ls,cs,us,hs,fs,ds,ps,ys,Pt,It=1,si=4,ts=It+si,ss=new ArrayBuffer(0),st=function(){function e(){_classCallCheck(this,e),v(this,E),v(this,D,new DataView(ss)),v(this,I,0),v(this,M,0),v(this,h,new ti)}return _createClass(e,[{key:"parse",value:function(e,t){m(this,E,gs).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);for(var r=n(this,M)+n(this,I),a=n(this,M);a+ts<=r;){var s=n(this,D).getUint8(a),i=n(this,D).getUint32(a+It,!1),u=It+i;if(!(u+a<=r))break;t(m(this,E,ws).call(this,a+ts,s,i,n(this,D).buffer)),a+=u}a===r?(g(this,D,new DataView(ss)),g(this,I,0),g(this,M,0)):(g(this,I,r-a),g(this,M,a))}}]),e}();D=new WeakMap,I=new WeakMap,M=new WeakMap,h=new WeakMap,E=new WeakSet,gs=function(e){if(n(this,I)>0){var t=n(this,I)+e.byteLength;if(t+n(this,M)>n(this,D).byteLength){var r;if(t<=n(this,D).byteLength&&n(this,M)>=n(this,I))r=n(this,D).buffer;else{for(var a=2*n(this,D).byteLength;t>=a;)a*=2;r=new ArrayBuffer(a)}new Uint8Array(r).set(new Uint8Array(n(this,D).buffer,n(this,M),n(this,I))),g(this,D,new DataView(r)),g(this,M,0)}new Uint8Array(n(this,D).buffer).set(new Uint8Array(e),n(this,M)+n(this,I)),g(this,I,t)}else g(this,D,new DataView(e)),g(this,M,0),g(this,I,e.byteLength)},ws=function(e,t,n,r){switch(t){case 50:return ce;case 49:return le;case 51:return ue;case 110:return he;case 115:return fe;case 99:return ye;case 87:return de;case 73:return pe;case 68:return m(this,E,fs).call(this,e,n,r);case 67:return m(this,E,is).call(this,e,n,r);case 90:return m(this,E,rs).call(this,e,n,r);case 65:return m(this,E,ls).call(this,e,n,r);case 82:return m(this,E,ys).call(this,e,n,r);case 83:return m(this,E,ds).call(this,e,n,r);case 75:return m(this,E,ps).call(this,e,n,r);case 69:return m(this,E,Pt).call(this,e,n,r,"error");case 78:return m(this,E,Pt).call(this,e,n,r,"notice");case 84:return m(this,E,cs).call(this,e,n,r);case 116:return m(this,E,hs).call(this,e,n,r);case 71:return m(this,E,as).call(this,e,n,r);case 72:return m(this,E,os).call(this,e,n,r);case 100:return m(this,E,ns).call(this,e,n,r);default:return new G("received invalid response: "+t.toString(16),n,"error")}},rs=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).string(1);return new De(t,a)},is=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).cstring();return new k(t,a)},ns=function(e,t,n){var r=n.slice(e,e+(t-4));return new Te(t,new Uint8Array(r))},as=function(e,t,n){return m(this,E,St).call(this,e,t,n,"copyInResponse")},os=function(e,t,n){return m(this,E,St).call(this,e,t,n,"copyOutResponse")},St=function(e,t,r,a){n(this,h).setBuffer(e,r);for(var s=0!==n(this,h).byte(),i=n(this,h).int16(),u=new xe(t,a,s,i),o=0;o<i;o++)u.columnTypes[o]=n(this,h).int16();return u},ls=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).int32(),s=n(this,h).cstring(),i=n(this,h).cstring();return new H(t,a,s,i)},cs=function(e,t,r){n(this,h).setBuffer(e,r);for(var a=n(this,h).int16(),s=new q(t,a),i=0;i<a;i++)s.fields[i]=m(this,E,us).call(this);return s},us=function(){var e=n(this,h).cstring(),t=n(this,h).int32(),r=n(this,h).int16(),a=n(this,h).int32(),s=n(this,h).int16(),i=n(this,h).int32(),u=0===n(this,h).int16()?es.text:es.binary;return new Se(e,t,r,a,s,i,u)},hs=function(e,t,r){n(this,h).setBuffer(e,r);for(var a=n(this,h).int16(),s=new Pe(t,a),i=0;i<a;i++)s.dataTypeIDs[i]=n(this,h).int32();return s},fs=function(e,t,r){n(this,h).setBuffer(e,r);for(var a=n(this,h).int16(),s=new Array(a),i=0;i<a;i++){var u=n(this,h).int32();s[i]=-1===u?null:n(this,h).string(u)}return new z(t,s)},ds=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).cstring(),s=n(this,h).cstring();return new ve(t,a,s)},ps=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).int32(),s=n(this,h).int32();return new Re(t,a,s)},ys=function(e,t,r){n(this,h).setBuffer(e,r);var a=n(this,h).int32();switch(a){case 0:return new me(t);case 3:return new ge(t);case 5:return new we(t,n(this,h).bytes(4));case 10:for(var s=[];;){var i=n(this,h).cstring();if(0===i.length)return new be(t,s);s.push(i)}case 11:return new Ee(t,n(this,h).string(t-8));case 12:return new Ae(t,n(this,h).string(t-8));default:throw new Error("Unknown authenticationOk message type "+a)}},Pt=function(e,t,r,a){n(this,h).setBuffer(e,r);for(var s={},i=n(this,h).string(1);"\0"!==i;)s[i]=n(this,h).cstring(),i=n(this,h).string(1);var u=s.M,o="notice"===a?new K(t,u):new G(u,t,a);return o.severity=s.S,o.code=s.C,o.detail=s.D,o.hint=s.H,o.position=s.P,o.internalPosition=s.p,o.internalQuery=s.q,o.where=s.W,o.schema=s.s,o.table=s.t,o.column=s.c,o.dataType=s.d,o.constraint=s.n,o.file=s.F,o.line=s.L,o.routine=s.R,o};var ie,X,J,Z,ne,Fe,ae,it,oe,Be,ke,Ue,ee,_,C,te,u,As,rt,Q,Ot,_t,_e,V,Ce,Y,Ct=function(e){function t(){var e,n,r,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t),x(this,u),x(this,ie,!1),x(this,X,!1),x(this,J,!1),x(this,Z,!1),x(this,ne,!1),x(this,Fe,new $),x(this,ae,new $),x(this,it,new $),x(this,oe,!1),this.debug=0,x(this,Be),x(this,ke,[]),x(this,Ue,new st),x(this,ee),x(this,_),x(this,C,new Map),x(this,te,new Set),i="string"==typeof s?_objectSpread({dataDir:s},i):s,this.dataDir=i.dataDir,void 0!==(null===(e=i)||void 0===e?void 0:e.debug)&&(this.debug=i.debug),void 0!==(null===(n=i)||void 0===n?void 0:n.relaxedDurability)&&P(this,ne,i.relaxedDurability),P(this,Be,null!==(r=i.extensions)&&void 0!==r?r:{}),this.waitReady=p(this,u,As).call(this,null!==(a=i)&&void 0!==a?a:{})}return _createClass(t,[{key:"Module",get:function(){return this.mod}},{key:"ready",get:function(){return f(this,ie)&&!f(this,X)&&!f(this,J)}},{key:"closed",get:function(){return f(this,J)}},{key:"close",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,u,_e).call(this);case 2:P(this,X,!0),t=_createForOfIteratorHelper(f(this,ke)),e.prev=4,t.s();case 6:if((n=t.n()).done){e.next=12;break}return r=n.value,e.next=10,r();case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:return e.prev=20,e.next=23,this.execProtocol(U.end());case 23:e.next=30;break;case 25:if(e.prev=25,e.t1=e.catch(20),"ExitStatus"===(a=e.t1).name&&0===a.status){e.next=30;break}throw e.t1;case 30:return e.next=32,this.fs.close(this.mod.FS);case 32:P(this,J,!0),P(this,X,!1);case 34:case"end":return e.stop()}}),e,this,[[4,14,17,20],[20,25]])})));return function(){return e.apply(this,arguments)}}()},{key:e,value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,u,_e).call(this);case 2:return e.next=4,f(this,ae).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(a,u,rt).call(a,t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sql",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s,i,u,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=o.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=o[a];return s=ot.apply(void 0,[t].concat(r)),i=s.query,u=s.params,e.next=4,this.query(i,u);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exec",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,u,_e).call(this);case 2:return e.next=4,f(this,ae).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(r,u,Q).call(r,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"transaction",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(this,u,_e).call(this);case 2:return e.next=4,f(this,ae).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(n,u,Q).call(n,"BEGIN");case 2:return r=!1,a=function(){if(r)throw new Error("Transaction is closed")},e.prev=3,e.t0=t,e.t1=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,s){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(),e.next=3,p(n,u,rt).call(n,t,r,s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),e.t2=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,a,s,i,o,c,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=h.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=h[s];return i=ot.apply(void 0,[t].concat(a)),o=i.query,c=i.params,e.next=4,p(n,u,rt).call(n,o,c);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.t3=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(),e.next=3,p(n,u,Q).call(n,t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.t4=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(),e.next=3,p(n,u,Q).call(n,"ROLLBACK");case 3:r=!0;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.t5={query:e.t1,sql:e.t2,exec:e.t3,rollback:e.t4,get closed(){return r}},e.next=12,(0,e.t0)(e.t5);case 12:if(s=e.sent,e.t6=r,e.t6){e.next=18;break}return r=!0,e.next=18,p(n,u,Q).call(n,"COMMIT");case 18:return e.abrupt("return",s);case 21:if(e.prev=21,e.t7=e.catch(3),e.t8=r,e.t8){e.next=27;break}return e.next=27,p(n,u,Q).call(n,"ROLLBACK");case 27:throw e.t7;case 28:case"end":return e.stop()}}),e,null,[[3,21]])}))));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execProtocolRaw",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s,i,o,c,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(h.length>1&&void 0!==h[1]?h[1]:{}).syncToFs,r=void 0===n||n,a=t.length,(s=this.mod)._interactive_write(a),s.HEAPU8.set(t,1),s._interactive_one(),o=(i=a+2)+s._interactive_read(),c=s.HEAPU8.subarray(i,o),e.t0=r,!e.t0){e.next=8;break}return e.next=8,p(this,u,Ce).call(this);case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execProtocol",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s,i,u,o=this,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=c.length>1&&void 0!==c[1]?c[1]:{}).syncToFs,a=void 0===r||r,s=n.onNotice,e.next=3,this.execProtocolRaw(t,{syncToFs:a});case 3:return i=e.sent,u=[],e.abrupt("return",(f(this,Ue).parse(i,(function(e){if(e instanceof G)throw P(o,Ue,new st),e;if(e instanceof K)o.debug>0&&console.warn(e),s&&s(e);else if(e instanceof k)switch(e.text){case"BEGIN":P(o,Z,!0);break;case"COMMIT":case"ROLLBACK":P(o,Z,!1)}else if(e instanceof H){var t=f(o,C).get(e.channel);t&&t.forEach((function(t){queueMicrotask((function(){return t(e.payload)}))})),f(o,te).forEach((function(t){queueMicrotask((function(){return t(e.channel,e.payload)}))}))}u.push([e,i])})),u));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listen",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(this,C).has(t)||f(this,C).set(t,new Set),f(this,C).get(t).add(n),e.next=4,this.exec("LISTEN ".concat(t));case 4:return e.abrupt("return",_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.unlisten(t,n);case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unlisten",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=9;break}if(null!==(r=f(this,C).get(t))&&void 0!==r&&r.delete(n),e.t0=0===(null===(a=f(this,C).get(t))||void 0===a?void 0:a.size),!e.t0){e.next=7;break}return e.next=6,this.exec("UNLISTEN ".concat(t));case 6:f(this,C).delete(t);case 7:e.next=12;break;case 9:return e.next=11,this.exec("UNLISTEN ".concat(t));case 11:f(this,C).delete(t);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onNotification",value:function(e){var t=this;return f(this,te).add(e),function(){f(t,te).delete(e)}}},{key:"offNotification",value:function(e){f(this,te).delete(e)}},{key:"dumpDataDir",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!==(n=null===(r=this.dataDir)||void 0===r?void 0:r.split("/").pop())&&void 0!==n?n:"pgdata",e.abrupt("return",this.fs.dumpTar(this.mod.FS,a,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n,r){var a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="string"==typeof n?_objectSpread({dataDir:n},null!==r&&void 0!==r?r:{}):null!==n&&void 0!==n?n:{},s=new t(a),e.next=3,s.waitReady;case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}(Symbol.asyncDispose);ie=new WeakMap,X=new WeakMap,J=new WeakMap,Z=new WeakMap,ne=new WeakMap,Fe=new WeakMap,ae=new WeakMap,it=new WeakMap,oe=new WeakMap,Be=new WeakMap,ke=new WeakMap,Ue=new WeakMap,ee=new WeakMap,_=new WeakMap,C=new WeakMap,te=new WeakMap,u=new WeakSet,As=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,s,i,o,c,h,l,d,m,v,g,w,y,b,k,x,C,R,T,S,E,A=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.fs){e.next=4;break}this.fs=t.fs,e.next=8;break;case 4:return a=Ut(t.dataDir),s=a.dataDir,i=a.fsType,e.next=7,Lt(s,i);case 7:this.fs=e.sent;case 8:return o={},c=[],h=["PGDATA=".concat(Ge),"PREFIX=".concat(at),"PGUSER=".concat(null!==(n=t.username)&&void 0!==n?n:"postgres"),"PGDATABASE=".concat(null!==(r=t.database)&&void 0!==r?r:"template1"),"MODE=REACT","REPL=N"].concat(_toConsumableArray(this.debug?["-d",this.debug.toString()]:[])),e.t0=_objectSpread,e.t1=_objectSpread({WASM_PREFIX:at,arguments:h,INITIAL_MEMORY:t.initialMemory,noExitRuntime:!0},this.debug>0?{print:console.info,printErr:console.error}:{print:function(){},printErr:function(){}}),e.t2={},e.next=16,Gt();case 16:return e.t3=e.sent,e.t4=[function(e){var t=e.FS.makedev(64,0),n={open:function(e){},close:function(e){},read:function(e,t,n,r,a){var s=f(A,ee);if(!s)throw new Error("No /dev/blob File or Blob provided to read from");var i=new Uint8Array(s);if(a>=i.length)return 0;for(var u=Math.min(i.length-a,r),o=0;o<u;o++)t[n+o]=i[a+o];return u},write:function(e,t,n,r,a){var s;return null!==(s=f(A,_))&&void 0!==s||P(A,_,[]),f(A,_).push(t.slice(n,n+r)),r},llseek:function(t,n,r){var a=f(A,ee);if(!a)throw new Error("No /dev/blob File or Blob provided to llseek");var s=n;if(1===r?s+=t.position:2===r&&(s=new Uint8Array(a).length),s<0)throw new e.FS.ErrnoError(28);return s}};e.FS.registerDevice(t,n),e.FS.mkdev("/dev/blob",t)}],e.t5={locateFile:e.t3,preRun:e.t4},l=(0,e.t0)(e.t1,e.t2,e.t5),e.next=22,this.fs.emscriptenOpts(l);case 22:l=e.sent,d=0,m=Object.entries(f(this,Be));case 24:if(!(d<m.length)){e.next=38;break}if(v=_slicedToArray(m[d],2),g=v[0],!((w=v[1])instanceof URL)){e.next=30;break}o[g]=xt(w),e.next=35;break;case 30:return e.next=32,w.setup(this,l);case 32:(y=e.sent).emscriptenOpts&&(l=y.emscriptenOpts),y.namespaceObj&&(this[g]=y.namespaceObj),y.bundlePath&&(o[g]=xt(y.bundlePath)),y.init&&c.push(y.init),y.close&&f(this,ke).push(y.close);case 35:d++,e.next=24;break;case 38:return l.pg_extensions=o,e.next=41,qt(l);case 41:return this.mod=e.sent,e.next=44,this.fs.initialSyncFs(this.mod.FS);case 44:if(!t.loadDataDir){e.next=50;break}if(!this.mod.FS.analyzePath(Ge+"/PG_VERSION").exists){e.next=47;break}throw new Error("Database already exists, cannot load from tarball");case 47:return p(this,u,Y).call(this,"pglite: loading data from tarball"),e.next=50,kt(this.mod.FS,t.loadDataDir);case 50:return this.mod.FS.analyzePath(Ge+"/PG_VERSION").exists?p(this,u,Y).call(this,"pglite: found DB, resuming"):p(this,u,Y).call(this,"pglite: no db"),e.next=53,Zt(this.mod,(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=p(A,u,Y)).call.apply(e,[A].concat(n))}));case 53:if(b=this.mod._pg_initdb()){e.next=56;break}throw new Error("INITDB failed to return value");case 56:if(!(1&b)){e.next=58;break}throw new Error("INITDB failed");case 58:if(!(2&b)){e.next=67;break}if(C=null!==(k=t.username)&&void 0!==k?k:"postgres",R=null!==(x=t.database)&&void 0!==x?x:"template1",!(4&b)){e.next=65;break}if(12&b){e.next=63;break}throw new Error("Invalid db/user combination");case 63:e.next=67;break;case 65:if("template1"===R||"postgres"===C){e.next=67;break}throw new Error("INITDB created a new datadir, but an alternative db/user was requested");case 67:return e.next=69,p(this,u,Ce).call(this);case 69:return e.next=71,p(this,u,Q).call(this,"SET search_path TO public;");case 71:P(this,ie,!0),T=0,S=c;case 73:if(!(T<S.length)){e.next=80;break}return E=S[T],e.next=77,E();case 77:T++,e.next=73;break;case 80:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),rt=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(this,Fe).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var s,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(a,u,Y).call(a,"runQuery",t,n,r),e.next=3,p(a,u,Ot).call(a,null===r||void 0===r?void 0:r.blob);case 3:return s=(null===n||void 0===n?void 0:n.map((function(e){return He(e,null===r||void 0===r?void 0:r.setAllTypes)})))||[],e.prev=4,e.t0=[],e.t1=_toConsumableArray,e.next=9,p(a,u,V).call(a,U.parse({text:t,types:s.map((function(e){return _slicedToArray(e,2)[1]}))}),r);case 9:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=_toConsumableArray,e.next=14,p(a,u,V).call(a,U.bind({values:s.map((function(e){return _slicedToArray(e,1)[0]}))}),r);case 14:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=_toConsumableArray,e.next=19,p(a,u,V).call(a,U.describe({type:"P"}),r);case 19:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=_toConsumableArray,e.next=24,p(a,u,V).call(a,U.execute({}),r);case 24:e.t11=e.sent,e.t12=(0,e.t10)(e.t11),i=e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12);case 27:return e.prev=27,e.next=30,p(a,u,V).call(a,U.sync(),r);case 30:return e.finish(27);case 31:if(p(a,u,_t).call(a),e.t13=f(a,Z),e.t13){e.next=36;break}return e.next=36,p(a,u,Ce).call(a);case 36:return e.abrupt("return",(f(a,_)&&(o=new Blob(f(a,_)),P(a,_,void 0)),Ye(i.map((function(e){return _slicedToArray(e,1)[0]})),r,o)[0]));case 37:case"end":return e.stop()}}),e,null,[[4,,27,31]])}))));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),Q=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(this,Fe).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(r,u,Y).call(r,"runExec",t,n),e.next=3,p(r,u,Ot).call(r,null===n||void 0===n?void 0:n.blob);case 3:return e.prev=3,e.next=6,p(r,u,V).call(r,U.query(t),n);case 6:a=e.sent;case 7:return e.prev=7,e.next=10,p(r,u,V).call(r,U.sync(),n);case 10:return e.finish(7);case 11:if(p(r,u,_t).call(r),e.t0=f(r,Z),e.t0){e.next=16;break}return e.next=16,p(r,u,Ce).call(r);case 16:return e.abrupt("return",(f(r,_)&&(s=new Blob(f(r,_)),P(r,_,void 0)),Ye(a.map((function(e){return _slicedToArray(e,1)[0]})),n,s)));case 17:case"end":return e.stop()}}),e,null,[[3,,7,11]])}))));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),Ot=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=P,e.t1=this,e.t2=ee,!t){e.next=9;break}return e.next=6,t.arrayBuffer();case 6:e.t3=e.sent,e.next=10;break;case 9:e.t3=void 0;case 10:e.t4=e.t3,(0,e.t0)(e.t1,e.t2,e.t4);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),_t=function(){P(this,ee,void 0)},_e=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f(this,X)){e.next=2;break}throw new Error("PGlite is closing");case 2:if(!f(this,J)){e.next=4;break}throw new Error("PGlite is closed");case 4:if(e.t0=f(this,ie),e.t0){e.next=8;break}return e.next=8,this.waitReady;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.execProtocol(t,_objectSpread(_objectSpread({},n),{},{syncToFs:!1}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f(this,oe)){e.next=2;break}return e.abrupt("return");case 2:if(P(this,oe,!0),t=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(n,it).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(n,oe,!1),e.next=3,n.fs.syncToFs(n.mod.FS,f(n,ne));case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),!f(this,ne)){e.next=8;break}t(),e.next=10;break;case 8:return e.next=10,t();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e;this.debug>0&&(e=console).log.apply(e,arguments)};var Es=Ct;b();export{Ss as IdbFs,Ps as MemoryFS,$ as Mutex,Es as PGlite,Rs as formatQuery,Wt as messages,Xt as parse,bs as protocol,Yt as types,vs as uuid};