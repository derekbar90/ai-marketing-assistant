import _toConsumableArray from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _createForOfIteratorHelper from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js";import _objectSpread from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _assertThisInitialized from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js";import _inherits from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js";import _asyncToGenerator from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js";import _regeneratorRuntime from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js";import _slicedToArray from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _classCallCheck from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/home/runner/work/ai-marketing-assistant/ai-marketing-assistant/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js";import{b as xe,d as ee,e as be,f as ve,g as V,h as $,i as te,j as ie}from"./chunk-SJVDOE3S.js";import{a as fe}from"./chunk-PKPYJS5H.js";import"./chunk-EL7DUS2A.js";import{a as se,b as re,c as ne,d as oe,e as ae,f as Ee,g as K,h as Pe,m as _e,p as Te,q as le,r as ce,s as de,t as ue,u as Fe,v as Oe}from"./chunk-AOCDFDRO.js";import{c as ge,d as r,e as f,f as h,g as D,i as y}from"./chunk-Y3AVQXKT.js";y(),y(),y();var Ie=new Error("timeout while waiting for mutex to become available"),ke=new Error("mutex already locked"),Se=new Error("request for lock canceled"),De=function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{u(n.next(e))}catch(t){i(t)}}function o(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){e.done?a(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}u((n=n.apply(e,t||[])).next())}))},X=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Se;_classCallCheck(this,e),this._value=t,this._cancelError=r,this._weightedQueues=[],this._weightedWaiters=[]}return _createClass(e,[{key:"acquire",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(r,n){e._weightedQueues[t-1]||(e._weightedQueues[t-1]=[]),e._weightedQueues[t-1].push({resolve:r,reject:n}),e._dispatch()}))}},{key:"runExclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return De(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n,a,i,s;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.acquire(t);case 2:return n=r.sent,a=_slicedToArray(n,2),i=a[0],s=a[1],r.prev=6,r.next=9,e(i);case 9:return r.abrupt("return",r.sent);case 10:return r.prev=10,s(),r.finish(10);case 13:case"end":return r.stop()}}),r,this,[[6,,10,13]])})))}},{key:"waitForUnlock",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(r){e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),e._weightedWaiters[t-1].push(r),e._dispatch()}))}},{key:"isLocked",value:function(){return this._value<=0}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e,this._dispatch()}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<=0)throw new Error("invalid weight ".concat(e,": must be positive"));this._value+=e,this._dispatch()}},{key:"cancel",value:function(){var e=this;this._weightedQueues.forEach((function(t){return t.forEach((function(t){return t.reject(e._cancelError)}))})),this._weightedQueues=[]}},{key:"_dispatch",value:function(){for(var e,t=this._value;t>0;t--){var r=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(r){var n=this._value,a=t;this._value-=t,t=this._value+1,r.resolve([n,this._newReleaser(a)])}}this._drainUnlockWaiters()}},{key:"_newReleaser",value:function(e){var t=this,r=!1;return function(){r||(r=!0,t.release(e))}}},{key:"_drainUnlockWaiters",value:function(){for(var e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((function(e){return e()})),this._weightedWaiters[e-1]=[])}}]),e}(),Ae=function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{u(n.next(e))}catch(t){i(t)}}function o(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){e.done?a(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}u((n=n.apply(e,t||[])).next())}))},_=function(){function e(t){_classCallCheck(this,e),this._semaphore=new X(1,t)}return _createClass(e,[{key:"acquire",value:function(){return Ae(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._semaphore.acquire();case 2:return t=e.sent,r=_slicedToArray(t,2),n=r[1],e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"runExclusive",value:function(e){return this._semaphore.runExclusive((function(){return e()}))}},{key:"isLocked",value:function(){return this._semaphore.isLocked()}},{key:"waitForUnlock",value:function(){return this._semaphore.waitForUnlock()}},{key:"release",value:function(){this._semaphore.isLocked()&&this._semaphore.release()}},{key:"cancel",value:function(){return this._semaphore.cancel()}}]),e}();y();import Me from"./postgres.js";var pe=Me;y();var he=ge(xe(),1);function Y(e){return _Y.apply(this,arguments)}function _Y(){return(_Y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a,i,s,o,u,c,l,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!le){e.next=23;break}return e.next=3,import("fs");case 3:return r=e.sent,e.next=6,import("zlib");case 6:return n=e.sent,e.next=9,import("stream");case 9:return a=e.sent,i=a.Writable,e.next=13,import("stream/promises");case 13:if(s=e.sent,o=s.pipeline,r.existsSync(t)){e.next=17;break}throw new Error("Extension bundle not found: ".concat(t));case 17:return u=n.createGunzip(),c=[],e.next=20,o(r.createReadStream(t),u,new i({write:function(e,t,r){c.push(e),r()}}));case 20:return e.abrupt("return",new Blob(c));case 23:return e.next=25,fetch(t.toString());case 25:if((l=e.sent).ok&&l.body){e.next=28;break}return e.abrupt("return",null);case 28:if("gzip"!==l.headers.get("Content-Encoding")){e.next=30;break}return e.abrupt("return",l.blob());case 30:return h=new DecompressionStream("gzip"),e.abrupt("return",new Response(l.body.pipeThrough(h)).blob());case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e,t){return _me.apply(this,arguments)}function _me(){return(_me=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,a,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=_regeneratorRuntime().keys(t.pg_extensions);case 1:if((e.t1=e.t0()).done){e.next=26;break}return n=e.t1.value,a=void 0,e.prev=4,e.next=7,t.pg_extensions[n];case 7:a=e.sent,e.next=14;break;case 10:return e.prev=10,e.t2=e.catch(4),console.error("Failed to fetch extension:",n,e.t2),e.abrupt("continue",1);case 14:if(!a){e.next=23;break}return e.t3=Uint8Array,e.next=18,a.arrayBuffer();case 18:e.t4=e.sent,i=new e.t3(e.t4),Re(t,n,i,r),e.next=24;break;case 23:console.error("Could not get binary data for extension:",n);case 24:e.next=1;break;case 26:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function Re(e,t,r,n){he.default.untar(r).forEach((function(t){if(!t.name.startsWith(".")){var r=e.WASM_PREFIX+"/"+t.name;if(t.name.endsWith(".so")){e.FS.createPreloadedFile(Be(r),t.name.split("/").pop().slice(0,-3),t.data,!0,!0,(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];n("pgfs:ext OK",r,t)}),(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];n("pgfs:ext FAIL",r,t)}),!1)}else e.FS.writeFile(r,t.data)}}))}function Be(e){var t=e.lastIndexOf("/");return t>0?e.slice(0,t):e}var A,T,F,M,R,C,Q,z,B,L,q,G,O,v,w,S,b,we,N,H=function(e,t){_inherits(a,e);var n=_createSuper(a);function a(){var e,t,r,i,s,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),s=n.call(this),f(_assertThisInitialized(s),b),f(_assertThisInitialized(s),A,!1),f(_assertThisInitialized(s),T,!1),f(_assertThisInitialized(s),F,!1),f(_assertThisInitialized(s),M,!1),f(_assertThisInitialized(s),R,!1),f(_assertThisInitialized(s),C,new _),f(_assertThisInitialized(s),Q,new _),f(_assertThisInitialized(s),z,new _),f(_assertThisInitialized(s),B,!1),s.debug=0,f(_assertThisInitialized(s),L),f(_assertThisInitialized(s),q,[]),f(_assertThisInitialized(s),G,new K),f(_assertThisInitialized(s),O),f(_assertThisInitialized(s),v),f(_assertThisInitialized(s),w,new Map),f(_assertThisInitialized(s),S,new Set),u="string"==typeof o?_objectSpread({dataDir:o},u):o,s.dataDir=u.dataDir,void 0!==(null===(e=u)||void 0===e?void 0:e.debug)&&(s.debug=u.debug),void 0!==(null===(t=u)||void 0===t?void 0:t.relaxedDurability)&&h(_assertThisInitialized(s),R,u.relaxedDurability),h(_assertThisInitialized(s),L,null!==(r=u.extensions)&&void 0!==r?r:{}),s.waitReady=D(_assertThisInitialized(s),b,we).call(_assertThisInitialized(s),null!==(i=u)&&void 0!==i?i:{}),s}return _createClass(a,[{key:"Module",get:function(){return this.mod}},{key:"ready",get:function(){return r(this,A)&&!r(this,T)&&!r(this,F)}},{key:"closed",get:function(){return r(this,F)}},{key:"close",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,a,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._checkReady();case 2:h(this,T,!0),t=_createForOfIteratorHelper(r(this,q)),e.prev=4,t.s();case 6:if((n=t.n()).done){e.next=12;break}return a=n.value,e.next=10,a();case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:return e.prev=20,e.next=23,this.execProtocol(se.end());case 23:this.mod._pg_shutdown(),e.next=31;break;case 26:if(e.prev=26,e.t1=e.catch(20),"ExitStatus"===(i=e.t1).name&&0===i.status){e.next=31;break}throw e.t1;case 31:return e.next=33,this.fs.close(this.mod.FS);case 33:h(this,F,!0),h(this,T,!1);case 35:case"end":return e.stop()}}),e,this,[[4,14,17,20],[20,26]])})));return function(){return e.apply(this,arguments)}}()},{key:t,value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_handleBlob",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=h,e.t1=this,e.t2=O,!t){e.next=9;break}return e.next=6,t.arrayBuffer();case 6:e.t3=e.sent,e.next=10;break;case 9:e.t3=void 0;case 10:e.t4=e.t3,(0,e.t0)(e.t1,e.t2,e.t4);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanupBlob",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(this,O,void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getWrittenBlob",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r(this,v)){e.next=2;break}return e.abrupt("return");case 2:return t=new Blob(r(this,v)),e.abrupt("return",(h(this,v,void 0),t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_checkReady",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r(this,T)){e.next=2;break}throw new Error("PGlite is closing");case 2:if(!r(this,F)){e.next=4;break}throw new Error("PGlite is closed");case 4:if(e.t0=r(this,A),e.t0){e.next=8;break}return e.next=8,this.waitReady;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"execProtocolRaw",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a,i,s,o,u,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(c.length>1&&void 0!==c[1]?c[1]:{}).syncToFs,n=void 0===r||r,a=t.length,(i=this.mod)._interactive_write(a),i.HEAPU8.set(t,1),i._interactive_one(),o=(s=a+2)+i._interactive_read(),u=i.HEAPU8.subarray(s,o),e.t0=n,!e.t0){e.next=8;break}return e.next=8,this.syncToFs();case 8:return e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execProtocol",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,a,i,s,o,u,c,l,f=this,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(n=p.length>1&&void 0!==p[1]?p[1]:{}).syncToFs,i=void 0===a||a,s=n.throwOnError,o=void 0===s||s,u=n.onNotice,e.next=3,this.execProtocolRaw(t,{syncToFs:i});case 3:return c=e.sent,l=[],e.abrupt("return",(r(this,G).parse(c,(function(e){if(e instanceof re){if(h(f,G,new K),o)throw e}else if(e instanceof ae)f.debug>0&&console.warn(e),u&&u(e);else if(e instanceof oe)switch(e.text){case"BEGIN":h(f,M,!0);break;case"COMMIT":case"ROLLBACK":h(f,M,!1)}else if(e instanceof ne){var t=r(f,w).get(e.channel);t&&t.forEach((function(t){queueMicrotask((function(){return t(e.payload)}))})),r(f,S).forEach((function(t){queueMicrotask((function(){return t(e.channel,e.payload)}))}))}l.push([e,c])})),l));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isInTransaction",value:function(){return r(this,M)}},{key:"syncToFs",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r(this,B)){e.next=2;break}return e.abrupt("return");case 2:if(h(this,B,!0),t=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(n,z).runExclusive(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(n,B,!1),e.next=3,n.fs.syncToFs(n.mod.FS,r(n,R));case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),!r(this,R)){e.next=8;break}t(),e.next=10;break;case 8:return e.next=10,t();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"listen",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r(this,w).has(t)||r(this,w).set(t,new Set),r(this,w).get(t).add(n),e.next=4,this.exec('LISTEN "'.concat(t,'"'));case 4:return e.abrupt("return",_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.unlisten(t,n);case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unlisten",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var a,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=9;break}if(null!==(a=r(this,w).get(t))&&void 0!==a&&a.delete(n),e.t0=0===(null===(i=r(this,w).get(t))||void 0===i?void 0:i.size),!e.t0){e.next=7;break}return e.next=6,this.exec('UNLISTEN "'.concat(t,'"'));case 6:r(this,w).delete(t);case 7:e.next=12;break;case 9:return e.next=11,this.exec('UNLISTEN "'.concat(t,'"'));case 11:r(this,w).delete(t);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onNotification",value:function(e){var t=this;return r(this,S).add(e),function(){r(t,S).delete(e)}}},{key:"offNotification",value:function(e){r(this,S).delete(e)}},{key:"dumpDataDir",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!==(r=null===(n=this.dataDir)||void 0===n?void 0:n.split("/").pop())&&void 0!==r?r:"pgdata",e.abrupt("return",this.fs.dumpTar(this.mod.FS,a,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_runExclusiveQuery",value:function(e){return r(this,C).runExclusive(e)}},{key:"_runExclusiveTransaction",value:function(e){return r(this,Q).runExclusive(e)}}],[{key:"create",value:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"==typeof t?_objectSpread({dataDir:t},null!==r&&void 0!==r?r:{}):null!==t&&void 0!==t?t:{},i=new a(n),e.next=3,i.waitReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),a}(fe,Symbol.asyncDispose);A=new WeakMap,T=new WeakMap,F=new WeakMap,M=new WeakMap,R=new WeakMap,C=new WeakMap,Q=new WeakMap,z=new WeakMap,B=new WeakMap,L=new WeakMap,q=new WeakMap,G=new WeakMap,O=new WeakMap,v=new WeakMap,w=new WeakMap,S=new WeakMap,b=new WeakSet,we=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,a,i,s,o,u,c,l,f,p,d,m,_,w,k,g,y,x,T,R,E,S,I,F,M,G=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.fs){e.next=4;break}this.fs=t.fs,e.next=8;break;case 4:return i=te(t.dataDir),s=i.dataDir,o=i.fsType,e.next=7,ie(s,o);case 7:this.fs=e.sent;case 8:return u={},c=[],l=["PGDATA=".concat($),"PREFIX=".concat(V),"PGUSER=".concat(null!==(n=t.username)&&void 0!==n?n:"postgres"),"PGDATABASE=".concat(null!==(a=t.database)&&void 0!==a?a:"template1"),"MODE=REACT","REPL=N"].concat(_toConsumableArray(this.debug?["-d",this.debug.toString()]:[])),t.wasmModule||ce(),(f=t.fsBundle?t.fsBundle.arrayBuffer():ue()).then((function(e){p=e})),d=_objectSpread(_objectSpread({WASM_PREFIX:V,arguments:l,INITIAL_MEMORY:t.initialMemory,noExitRuntime:!0},this.debug>0?{print:console.info,printErr:console.error}:{print:function(){},printErr:function(){}}),{},{instantiateWasm:function(e,r){return de(e,t.wasmModule).then((function(e){var t=e.instance,n=e.module;r(t,n)})),{}},getPreloadedPackage:function(e,t){if("postgres.data"===e){if(p.byteLength!==t)throw new Error("Invalid FS bundle size: ".concat(p.byteLength," !== ").concat(t));return p}throw new Error("Unknown package: ".concat(e))},preRun:[function(e){var t=e.FS.makedev(64,0),n={open:function(e){},close:function(e){},read:function(e,t,n,a,i){var s=r(G,O);if(!s)throw new Error("No /dev/blob File or Blob provided to read from");var o=new Uint8Array(s);if(i>=o.length)return 0;for(var u=Math.min(o.length-i,a),c=0;c<u;c++)t[n+c]=o[i+c];return u},write:function(e,t,n,a,i){var s;return null!==(s=r(G,v))&&void 0!==s||h(G,v,[]),r(G,v).push(t.slice(n,n+a)),a},llseek:function(t,n,a){var i=r(G,O);if(!i)throw new Error("No /dev/blob File or Blob provided to llseek");var s=n;if(1===a?s+=t.position:2===a&&(s=new Uint8Array(i).length),s<0)throw new e.FS.ErrnoError(28);return s}};e.FS.registerDevice(t,n),e.FS.mkdev("/dev/blob",t)}]}),e.next=15,this.fs.emscriptenOpts(d);case 15:d=e.sent,m=0,_=Object.entries(r(this,L));case 17:if(!(m<_.length)){e.next=31;break}if(w=_slicedToArray(_[m],2),k=w[0],!((g=w[1])instanceof URL)){e.next=23;break}u[k]=Y(g),e.next=28;break;case 23:return e.next=25,g.setup(this,d);case 25:(y=e.sent).emscriptenOpts&&(d=y.emscriptenOpts),y.namespaceObj&&(this[k]=y.namespaceObj),y.bundlePath&&(u[k]=Y(y.bundlePath)),y.init&&c.push(y.init),y.close&&r(this,q).push(y.close);case 28:m++,e.next=17;break;case 31:return d.pg_extensions=u,e.next=34,f;case 34:return e.next=36,pe(d);case 36:return this.mod=e.sent,e.next=39,this.fs.initialSyncFs(this.mod.FS);case 39:if(!t.loadDataDir){e.next=45;break}if(!this.mod.FS.analyzePath($+"/PG_VERSION").exists){e.next=42;break}throw new Error("Database already exists, cannot load from tarball");case 42:return D(this,b,N).call(this,"pglite: loading data from tarball"),e.next=45,ee(this.mod.FS,t.loadDataDir);case 45:return this.mod.FS.analyzePath($+"/PG_VERSION").exists?D(this,b,N).call(this,"pglite: found DB, resuming"):D(this,b,N).call(this,"pglite: no db"),e.next=48,me(this.mod,(function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=D(G,b,N)).call.apply(e,[G].concat(r))}));case 48:if(x=this.mod._pg_initdb()){e.next=51;break}throw new Error("INITDB failed to return value");case 51:if(!(1&x)){e.next=53;break}throw new Error("INITDB failed");case 53:if(!(2&x)){e.next=62;break}if(E=null!==(T=t.username)&&void 0!==T?T:"postgres",S=null!==(R=t.database)&&void 0!==R?R:"template1",!(4&x)){e.next=60;break}if(12&x){e.next=58;break}throw new Error("Invalid db/user combination");case 58:e.next=62;break;case 60:if("template1"===S||"postgres"===E){e.next=62;break}throw new Error("INITDB created a new datadir, but an alternative db/user was requested");case 62:return e.next=64,this.syncToFs();case 64:return h(this,A,!0),e.next=67,this.exec("SET search_path TO public;");case 67:return e.next=69,this._initArrayTypes();case 69:I=0,F=c;case 70:if(!(I<F.length)){e.next=77;break}return M=F[I],e.next=74,M();case 74:I++,e.next=70;break;case 77:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e;this.debug>0&&(e=console).log.apply(e,arguments)};var ye=H;y();export{be as IdbFs,ve as MemoryFS,_ as Mutex,ye as PGlite,Oe as formatQuery,Ee as messages,Te as parse,Pe as protocol,_e as types,Fe as uuid};